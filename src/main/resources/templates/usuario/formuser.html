<html lang="pt" layout:decorate="~{layouts/layout-index}">
<head>
<meta charset="utf-8">
<title>Livraria LM - Cadastrar Usuário</title>

<!-- Adicionando Javascript -->
<script type="text/javascript">
	function limpa_formulário_cep() {
		//Limpa valores do formulário de cep.
		document.getElementById('rua').value = ("");
		document.getElementById('bairro').value = ("");
		document.getElementById('cidade').value = ("");
		document.getElementById('uf').value = ("");
		document.getElementById('ibge').value = ("");
	}

	function meu_callback(conteudo) {
		if (!("erro" in conteudo)) {
			//Atualiza os campos com os valores.
			document.getElementById('rua').value = (conteudo.logradouro);
			document.getElementById('bairro').value = (conteudo.bairro);
			document.getElementById('cidade').value = (conteudo.localidade);
			document.getElementById('uf').value = (conteudo.uf);
			document.getElementById('ibge').value = (conteudo.ibge);
		} //end if.
		else {
			//CEP não Encontrado.
			limpa_formulário_cep();
			alert("CEP não encontrado.");
		}
	}

	function pesquisacep(valor) {

		//Nova variável "cep" somente com dígitos.
		var cep = valor.replace(/\D/g, '');

		//Verifica se campo cep possui valor informado.
		if (cep != "") {

			//Expressão regular para validar o CEP.
			var validacep = /^[0-9]{8}$/;

			//Valida o formato do CEP.
			if (validacep.test(cep)) {

				//Preenche os campos com "..." enquanto consulta webservice.
				document.getElementById('rua').value = "...";
				document.getElementById('bairro').value = "...";
				document.getElementById('cidade').value = "...";
				document.getElementById('uf').value = "...";
				document.getElementById('ibge').value = "...";

				//Cria um elemento javascript.
				var script = document.createElement('script');

				//Sincroniza com o callback.
				script.src = 'https://viacep.com.br/ws/' + cep
						+ '/json/?callback=meu_callback';

				//Insere script no documento e carrega o conteúdo.
				document.body.appendChild(script);

			} //end if.
			else {
				//cep é inválido.
				limpa_formulário_cep();
				alert("Formato de CEP inválido.");
			}
		} //end if.
		else {
			//cep sem valor, limpa formulário.
			limpa_formulário_cep();
		}
	};
</script>

</head>
<body>
	<!-- SECTION -->
	<div class="section" layout:fragment="corpo">
		<!-- container -->
		<!-- DIV de Alerta de Sucessos -->
		<div class="alert alert-success alert-dismissible" role="alert"
			th:if="${msg}">
			<button type="button" class="close" data-dismiss="alert"
				aria-label="Close">
				<span aria-hidden="true">&times;</span>
			</button>

			<strong>Sucesso!</strong> <a th:text="${msg}"></a>

		</div>
		<div class="container" align="center">
			<!-- row -->
			<div class="row">

				<div class="col-md-12" align="center">
					<!-- Billing Details -->
					<div class="billing-details">
						<div class="section-title">
							<h3 class="title">Cadastro de Usuários</h3>
						</div>
						<div class="col-md-12">
							<form method="post" th:object="${usuario}"
								th:action="@{/usuario/save}">

								<!-- Input responsável por guardar o ID -->
								<input id="id" name="id" type="hidden" th:field="*{id}"
									th:value="*{id}">

								<!-- DIV de Alerta de Erros -->
								<div class="alert alert-danger alert-dismissible" role="alert"
									th:if="${#fields.hasAnyErrors()}">
									<button type="button" class="close" data-dismiss="alert"
										aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
									<div th:each="detailedError : ${#fields.detailedErrors()}">
										<strong>Atenção!</strong> <a
											th:text="${detailedError.message}"></a>
									</div>
								</div>

								<fieldset>
									<legend>Dados do Usuário</legend>
									<div class="col-md-6">
										<div class="form-group"
											th:classappend="${#fields.hasErrors('nome')}? 'has-error'">
											<input class="input" type="text" placeholder="Nome completo"
												th:field="*{nome}">
										</div>
									</div>

									<div class="col-md-6">
										<div class="form-group"
											th:classappend="${#fields.hasErrors('username')}? 'has-error'">
											<input class="input" type="email" placeholder="Email"
												th:field="*{username}"><br>
											<h6 align="left" class="form-group">*Insira um endereço
												de email válido</h6>
										</div>
									</div>

								</fieldset>
								<br>
								<fieldset>
									<legend>Endereço</legend>
									<div class="col-md-4">
										<div class="form-group"
											th:classappend="${#fields.hasErrors('cep')}? 'has-error'">
											<input class="input" type="text" name="cep" id="cep"
												onblur="pesquisacep(this.value);"
												placeholder="Código Postal  (CEP)" th:field="*{cep}">
										</div>
									</div>

									<div class="col-md-4">
										<div class="form-group"
											th:classappend="${#fields.hasErrors('cidade')}? 'has-error'">
											<input class="input" type="text" placeholder="Cidade"
												name="cidade" id="cidade" th:field="*{cidade}">
										</div>
									</div>

									<div class="col-md-1">
										<div class="form-group"
											th:classappend="${#fields.hasErrors('uf')}? 'has-error'">
											<input class="input" type="text" name="uf" id="uf"
												placeholder="UF" th:field="*{uf}">
										</div>
									</div>

									<div class="col-md-4">
										<div class="form-group"
											th:classappend="${#fields.hasErrors('rua')}? 'has-error'">
											<input class="input" name="rua" id="rua" type="text"
												placeholder="Rua" th:field="*{rua}">
										</div>
									</div>

									<div class="col-md-4">
										<div class="form-group"
											th:classappend="${#fields.hasErrors('bairro')}? 'has-error'">
											<input class="input" type="text" name="bairro" id="bairro"
												placeholder="Bairro" th:field="*{bairro}">
										</div>
									</div>

									<div class="col-md-4">
										<div class="form-group"
											th:classappend="${#fields.hasErrors('numero')}? 'has-error'">
											<input class="input" type="text" placeholder="Numero"
												th:field="*{numero}">
										</div>
									</div>
								</fieldset>
								<br>

								<fieldset>
									<legend>Dados de Login</legend>
									<div class="col-md-6">
										<div class="form-group"
											th:classappend="${#fields.hasErrors('password')}? 'has-error'">
											<input class="input" name="senha"
												placeholder="Crie uma senha" type="password"
												th:field="*{password}">
										</div>
									</div>

									<div class="col-md-6">
										<div class="form-group">
											<input class="input" name="rep_senha"
												placeholder="Confirme a senha" type="password">
										</div>
									</div>

								</fieldset>

								<div class="col-md-12">
									<div class="form-group">
										<button type="submit" class="primary-btn cta-btn">Cadastrar</button>
										<a th:href="@{/}" class="primary-btn cta-btn">Entrar</a>
									</div>
								</div>
							
							</form>

						</div>

					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- /Billing Details -->

</body>
</html>